graph TD
    subgraph adminTrigger ["Event: Admin Flags Node X as Duplicate"]
        startAdmin((Start)) --> isMarked{"Is Node X already<br/>marked 'toBeDeleted'?"}
        
        isMarked -->|"No (Fresh Flag)"| markX1["1. Set toBeDeleted = TRUE<br/>2. Set duplicateOf = SurvivorID"]
        markX1 --> checkKids1{"Has Children?"}
        
        %% Admin Trigger Check 1
        checkKids1 -->|"No (Lone Node)"| parentZombie1{"Is my Parent<br/>marked 'toBeDeleted'?"}
        parentZombie1 -->|"Yes"| die1[/"DELETE Node X"/]
        parentZombie1 -->|"No"| perm1[/"PERMANENT ZOMBIE"/]
        
        checkKids1 -->|"Yes (Start Zombie Branch)"| cascade["TRIGGER: Mark ALL Children for Death!<br/>(Recursion)"]
        
        isMarked -->|"Yes (Update/Redundant)"| checkKids2{"Has Children?"}
        
        checkKids2 -->|"Yes (Just Update)"| updateID["Update duplicateOf = SurvivorID"]
        
        %% Admin Trigger Check 2
        checkKids2 -->|"No (Ready to Die)"| parentZombie2{"Is my Parent<br/>marked 'toBeDeleted'?"}
        parentZombie2 -->|"Yes"| die2[/"DELETE Node X"/]
        die2 --> signalParent2["SEND SIGNAL: 'Parent, I died'"]
        parentZombie2 -->|"No"| perm2[/"PERMANENT ZOMBIE"/]
    end

    subgraph signalTrigger ["Event: Parent Receives Death Signal"]
        startSignal((Signal Received)) --> integrity{"Integrity Check:<br/>Is the Dead Child<br/>still in my list?"}
        
        integrity -->|"Yes (Error!)"| alertAdmin["ALERT ADMIN:<br/>DB Consistency Failure"]
        
        integrity -->|"No (Clean)"| checkRemaining{"Do I have ANY<br/>remaining children?"}
        
        checkRemaining -->|"Yes (>0)"| ignore["Ignore Signal<br/>(Stay Zombie)"]
        
        %% Signal Trigger Check
        checkRemaining -->|"No (I am now empty)"| parentZombie3{"Is my Parent<br/>marked 'toBeDeleted'?"}
        parentZombie3 -->|"Yes"| dieSignal[/"DELETE Self"/]
        dieSignal --> bubbleUp["SEND SIGNAL: 'Grandparent, I died'"]
        parentZombie3 -->|"No"| perm3[/"PERMANENT ZOMBIE"/]
    end

    style die1 fill:#ffcccc,stroke:#b71c1c,stroke-width:2px
    style die2 fill:#ffcccc,stroke:#b71c1c,stroke-width:2px
    style dieSignal fill:#ffcccc,stroke:#b71c1c,stroke-width:2px
    
    style perm1 fill:#ffffcc,stroke:#fc0,stroke-width:3px,stroke-dasharray: 5 5
    style perm2 fill:#ffffcc,stroke:#fc0,stroke-width:3px,stroke-dasharray: 5 5
    style perm3 fill:#ffffcc,stroke:#fc0,stroke-width:3px,stroke-dasharray: 5 5
    
    style signalParent2 fill:#e1f5fe,stroke:#01579b,stroke-dasharray: 5 5
    style bubbleUp fill:#e1f5fe,stroke:#01579b,stroke-dasharray: 5 5
    
    style alertAdmin fill:#ff0000,stroke:#fff,color:#fff