graph TD
    %% 1. The Entry Point: Contextual Initialization
    Start((Start)) --> Context{Check Root Context}
    Context -->|"Set/Ops Defined"| Search{Search Axiom}
    Context -->|"New Branch"| DefineRoot["Define Root Environment<br/>(Sets & Operators)"]
    DefineRoot --> Search

    Search -->|"Found"| Select["Select & Match Notation<br/>(Check LaTeX vs Render)"]
    Search -->|"Not Found"| CreateAx["Define New Axiom (Registry)"]
    
    Select --> Unverified
    CreateAx --> Unverified

    %% 2. The Live Tree States
    subgraph LiveTree ["The Visible Tree"]
        Unverified[/"Live Node (Unverified)<br/>Color: RED<br/>(Stats: Green Votes vs Black Votes)"/]
        Verified[/"Live Node (Verified)<br/>Color: GREEN"/]
        Contested[/"Flagged Node<br/>Color: YELLOW"/]
        DeadEnd[/"Dead End (Inconsistent)<br/>Color: GRAY"/]
        Zombie[/"Zombie Node (Deprecated)<br/>Color: Flashing YELLOW<br/>(No New Children Allowed)"/]
    end

    %% 3. The Red Workflow
    Unverified -->|"Admin Approves (Valid)"| Verified
    Unverified -->|"Admin Confirms Inconsistency"| DeadEnd
    Unverified -->|"Admin Rejects (Spam)"| Delete((Deleted))
    
    %% 4. The Flagging Workflow: Focus on Duplication
    Verified -->|"Viewer/Contributor Flags Issue"| Contested
    
    Verified -.->|"Flagged as Duplicate Axiom"| AxiomFlag{"Admin Review<br/>(Merge Request)"}
    
    %% NEW: Combined Duplication Flag (Notation or Permutation)
    Verified -.->|"Flagged as Duplicate Node"| DeprecateFlag{"Admin Review<br/>(Notation/Permutation)"}

    %% 5. The Resolution Workflow
    Contested -->|"Admin Dismisses (False Alarm)"| Verified
    Contested -->|"Admin Applies Fix (Node Edit)"| Verified
    Contested -->|"Admin Confirms Inconsistency"| DeadEnd
    Contested -->|"Admin Deprecates"| Zombie
    
    %% 6. The Axiom Merge Workflow
    AxiomFlag -->|"Admin Approves (Merge)"| SystemUpdate["System Redirects Pointers"]
    SystemUpdate --> Verified
    SystemUpdate -.->|"Old Axiom Deleted"| Delete
    AxiomFlag -->|"Admin Rejects (Distinct)"| Verified

    %% 7. The Deprecation Workflow (Zombie Protocol)
    DeprecateFlag -->|"Admin Marks as Duplicate"| Zombie
    Zombie -.->|"Manual/Auto Cleanup<br/>(Theorem Migration)"| Delete
    DeprecateFlag -->|"Admin Rejects (Distinct)"| Verified

    %% 8. Maintenance Loop
    Verified -->|"Admin Edits (Direct Fix)"| Verified

    %% 9. Roles & Rules
    NoteRoles[/"ROLES:<br/>1. Viewer: Read Only<br/>2. Voter: Vote & Flag<br/>3. Contributor: Create, Vote, Flag<br/>4. Admin: Full Authority"/]
    style NoteRoles fill:#e1f5fe,stroke:#01579b,stroke-dasharray: 5 5

    NoteNotation[/"NOTATION RULE:<br/>Contributors must use LaTeX symbols<br/>consistent with the Root Node's<br/>Operator definitions."/]
    style NoteNotation fill:#fff,stroke:#333,stroke-dasharray: 5 5

    NoteCascade[/"UPDATE CASCADE:<br/>If Parent environment is changed,<br/>all children revert to Red Status."/]
    style NoteCascade fill:#ffeeee,stroke:#ff0000,stroke-dasharray: 5 5
    
    NoteRoles -.-> Start
    NoteNotation -.-> Select
    NoteCascade -.-> Verified

    %% Styling
    style Unverified fill:#ffcccc,stroke:#f00
    style Verified fill:#ccffcc,stroke:#0f0
    style Contested fill:#ffffcc,stroke:#fc0
    style DeadEnd fill:#eee,stroke:#333
    style Delete fill:#fff,stroke:#000,stroke-width:1px
    style AxiomFlag fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    style DeprecateFlag fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    style Zombie fill:#ffffcc,stroke:#fc0,stroke-dasharray: 5 5