classDiagram
    %% ==========================================
    %% 1. USER & GOVERNANCE
    %% ==========================================
    class User {
        +String id PK
        +String email
        %% Permissions based on Trust Ladder (Visitor -> Novice -> Citizen -> Admin)
        +String role 
        +Int creationReputation
        +Int contributorReputation
    }

    class Vote {
        +String id PK
        +String targetNodeId FK
        +String userId FK
        %% Green = Valid, Black = Invalid
        +String type 
        +Timestamp timestamp
    }
    
    class Flag {
        +String id PK
        +String targetNodeId FK
        +String reporterId FK
        
        %% Issue = General Error, Duplicate = Redundant Branch
        +String type
        +String reason 
        +String suggestedFixLatex 
        
        %% If type is Duplicate, this points to the Survivor Node
        +String duplicateOfId
        +String status
    }

    %% ==========================================
    %% 2. THE FOUNDATION (ROOTS & AXIOMS)
    %% ==========================================
    class RootEnvironment {
        +String id PK
        +String name
        %% The fundamental Sets for this branch (e.g., ['S'])
        +Array~String~ sets
        %% The fundamental Operators for this branch (e.g., ['*', '+'])
        +Array~String~ operators
    }

    class Axiom {
        +String id PK
        %% The canonical name (e.g., 'Commutativity')
        +String canonicalName
        %% Search synonyms (e.g., ['Abelian', 'Symmetric'])
        +Array~String~ aliases
        %% Default notation (e.g., a \cdot b = b \cdot a)
        +String defaultLatex
        +String authorId FK
        +Timestamp createdAt
    }
    
    note for Axiom "The 'Concept' Library.\nStores unique definitions independent of the tree."

    %% ==========================================
    %% 3. THE STRUCTURAL TREE
    %% ==========================================
    class StructureNode {
        +String id PK
        +String parentId FK
        +String authorId FK
        
        %% Links to the Abstract Concept (Null for Root Definition Nodes)
        +String axiomId FK
        %% Context-specific notation override
        +String displayLatex
        
        %% Lifecycle: unverified -> verified -> contested -> deadEnd -> deprecated
        +String status
        
        %% -- ZOMBIE PROTOCOL --
        %% Points to the Survivor Node if this is a duplicate
        +String duplicateOfId
        %% If true, triggers 'Zombie' state (Historical Marker)
        +Boolean toBeDeleted
        
        %% -- REPUTATION --
        +Int voteCountGreen
        +Int voteCountBlack
        +Int flagCountYellow
    }

    %% ==========================================
    %% RELATIONSHIPS
    %% ==========================================
    
    %% User Actions
    User "1" -- "*" StructureNode : creates
    User "1" -- "*" Axiom : creates
    User "1" -- "*" Vote : casts
    User "1" -- "*" Flag : reports
    
    %% Structural Logic
    Axiom "1" -- "*" StructureNode : defines
    StructureNode "1" -- "*" StructureNode : branches
    
    %% Governance Logic
    StructureNode "1" -- "*" Vote : receives
    StructureNode "1" -- "*" Flag : receives